import{_ as s,c as n,o as a,h as e}from"./app.102f7a7e.js";const C=JSON.parse('{"title":"vuex\u63D2\u4EF6","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.plugins\u7684\u5B9E\u73B0","slug":"_1-plugins\u7684\u5B9E\u73B0","link":"#_1-plugins\u7684\u5B9E\u73B0","children":[]},{"level":2,"title":"2.subscribe\u7684\u5B9E\u73B0","slug":"_2-subscribe\u7684\u5B9E\u73B0","link":"#_2-subscribe\u7684\u5B9E\u73B0","children":[]},{"level":2,"title":"3.replaceState\u7684\u5B9E\u73B0","slug":"_3-replacestate\u7684\u5B9E\u73B0","link":"#_3-replacestate\u7684\u5B9E\u73B0","children":[]}],"relativePath":"blogs/front-frame/vue3/vuex/whole-vuex/plugins.md","lastUpdated":1669132130000}'),l={name:"blogs/front-frame/vue3/vuex/whole-vuex/plugins.md"},p=e(`<h1 id="vuex\u63D2\u4EF6" tabindex="-1">vuex\u63D2\u4EF6 <a class="header-anchor" href="#vuex\u63D2\u4EF6" aria-hidden="true">#</a></h1><p>\u5982\u679C\u6211\u4EEC\u8981\u5B9E\u73B0\u4E00\u4E2A\u72B6\u6001\u6570\u636E\u6301\u4E45\u5316\u7684\u529F\u80FD\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7vuex\u63D2\u4EF6\u7684\u5F62\u5F0F\u6765\u505A</p><p>\u5148\u5199\u597D\u4E00\u4E2A\u63D2\u4EF6</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function persists(store) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let local = localStorage.getItem(&#39;VUEX:STATE&#39;);</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (local) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // \u66F4\u65B0\u539F\u6709\u72B6\u6001</span></span>
<span class="line"><span style="color:#A6ACCD;">    store.replaceState(JSON.parse(local));</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // \u4EC0\u4E48\u65F6\u5019\u6267\u884C\u56DE\u8C03\u5462\uFF1F\u72B6\u6001\u53D8\u5316\u5C31\u6267\u884C\u56DE\u8C03</span></span>
<span class="line"><span style="color:#A6ACCD;">  store.subscribe((mutation, state) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // \u53EA\u8981\u9891\u7E41\u64CD\u4F5C\uFF0C\u90A3\u4E48\u8981\u8003\u8651\u9632\u6296\u8282\u6D41</span></span>
<span class="line"><span style="color:#A6ACCD;">    localStorage.setItem(&#39;VUEX:STATE&#39;, JSON.stringify(state));</span></span>
<span class="line"><span style="color:#A6ACCD;">  });</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u4F7F\u7528\u63D2\u4EF6</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">new Vuex.Store({</span></span>
<span class="line"><span style="color:#A6ACCD;">  plugins: [persists],</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>vuex\u63D2\u4EF6\u5176\u5B9E\u5C31\u53EA\u662F\u4E00\u4E2A\u51FD\u6570\uFF0Cvuex\u5728\u6CE8\u518C\u7684\u65F6\u5019\u4F1A\u7ED9\u8FD9\u4E2A\u51FD\u6570\u4F20\u5F53\u524D\u7684Store\u5B9E\u4F8B</p><h2 id="_1-plugins\u7684\u5B9E\u73B0" tabindex="-1">1.plugins\u7684\u5B9E\u73B0 <a class="header-anchor" href="#_1-plugins\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u63D2\u4EF6\u7684\u5B9E\u73B0\u5F88\u7B80\u5355\uFF0C\u5728Store\u6784\u9020\u51FD\u6570\u91CC\u9762\u6DFB\u52A0</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">options.plugins.forEach((plugin) =&gt; plugin(this));</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-subscribe\u7684\u5B9E\u73B0" tabindex="-1">2.subscribe\u7684\u5B9E\u73B0 <a class="header-anchor" href="#_2-subscribe\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u5728\u5F00\u5934\u7684\u63D2\u4EF6\u6848\u4F8B\u91CC\u9762\u53D1\u73B0Store\u5B9E\u4F8B\u7684subscribe\u65B9\u6CD5\u53EF\u4EE5\u76D1\u542Cstate\u7684\u53D8\u5316\uFF0C\u5176\u5B9E\u8FD9\u4E2A\u4E5F\u662F\u4E00\u4E2A\u53D1\u5E03\u8BA2\u9605</p><p>\u73B0\u5728Store\u6784\u9020\u51FD\u6570\u91CC\u9762\u5B9A\u4E49\u4E00\u4E2A\u6570\u7EC4\uFF0C\u8FD9\u4E2A\u6570\u7EC4\u7528\u6765\u5B58\u653E\u8BA2\u9605\u7684\u51FD\u6570</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">this._subscribers = [];</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u90A3\u4EC0\u4E48\u4E4B\u540E\u6267\u884C_subscribers\u91CC\u9762\u7684\u51FD\u6570\u5462\uFF1Fvuex\u89C4\u5B9A\u53EA\u6709mutation\u53EF\u4EE5\u4FEE\u6539state\uFF0C\u90A3\u4E48\u5C31\u662F\u8BF4\u5728mutation\u89E6\u53D1\u7684\u65F6\u5019\uFF0C\u4F1A\u6267\u884C\u6240\u6709\u7684 _subscribers\u3002</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">// \u5728installModule\u91CC\u9762\u904D\u5386mutation\u7684\u65F6\u5019\uFF0C\u6267\u884C_subscribers</span></span>
<span class="line"><span style="color:#A6ACCD;">module.forEachMutation((mutation, type) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // changeAge:[fn,fn,fn] \u53D1\u5E03\u8BA2\u9605</span></span>
<span class="line"><span style="color:#A6ACCD;">    store._mutations[namespace + type] =</span></span>
<span class="line"><span style="color:#A6ACCD;">      store._mutations[namespace + type] || [];</span></span>
<span class="line"><span style="color:#A6ACCD;">    store._mutations[namespace + type].push((payload) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      mutation.call(store, getState(store, path), payload);</span></span>
<span class="line"><span style="color:#A6ACCD;">      // \u8C03\u7528subscribe\u8BA2\u9605\u7684\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">      store._subscribers.forEach((sub) =&gt; sub({ mutation, type }, store.state));</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_3-replacestate\u7684\u5B9E\u73B0" tabindex="-1">3.replaceState\u7684\u5B9E\u73B0 <a class="header-anchor" href="#_3-replacestate\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u5728\u5F00\u5934\u7684\u63D2\u4EF6\u6848\u4F8B\u91CC\u9762\u8FD8\u53D1\u73B0Store\u5B9E\u4F8B\u7684replaceState\u65B9\u6CD5\u53EF\u4EE5\u76F4\u63A5\u4FEE\u6539state</p><p>\u5B83\u7684\u5B9E\u73B0\u66F4\u7B80\u5355</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">replaceState(newState) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // \u7528\u6700\u65B0\u7684\u72B6\u6001\u66FF\u6362\u6389</span></span>
<span class="line"><span style="color:#A6ACCD;">    this._vm.data.$$state = newState;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,20),r=[p];function c(t,i,o,u,b,d){return a(),n("div",null,r)}const m=s(l,[["render",c]]);export{C as __pageData,m as default};
