import{_ as s,c as n,o as a,h as p}from"./app.ce6f49de.js";const m=JSON.parse('{"title":"single-spa\u7684\u5B9E\u73B0\u3010\u4E0A\u3011","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4E00\u3001registerApplication\u7684\u5B9E\u73B0","slug":"\u4E00\u3001registerapplication\u7684\u5B9E\u73B0","link":"#\u4E00\u3001registerapplication\u7684\u5B9E\u73B0","children":[]}],"relativePath":"blogs/front-frame/microfront/realize-single-spa-1.md","lastUpdated":1716104157000}'),l={name:"blogs/front-frame/microfront/realize-single-spa-1.md"},e=p(`<h1 id="single-spa\u7684\u5B9E\u73B0\u3010\u4E0A\u3011" tabindex="-1">single-spa\u7684\u5B9E\u73B0\u3010\u4E0A\u3011 <a class="header-anchor" href="#single-spa\u7684\u5B9E\u73B0\u3010\u4E0A\u3011" aria-hidden="true">#</a></h1><p>\u8FD8\u8BB0\u5F97\u4E0A\u4E00\u8282\u6211\u4EECsingle-spa\u662F\u600E\u4E48\u4F7F\u7528\u7684\u5417\uFF1F\uFF0C\u7B80\u5316\u6765\u8BF4\u5C31\u662F\u8FD9\u6837\u7684</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">let app1 = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    bootstrap: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        async () =&gt; console.log(&#39;app1 bootstrap1&#39;),</span></span>
<span class="line"><span style="color:#A6ACCD;">        async () =&gt; console.log(&#39;app1 bootstrap2&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    ],</span></span>
<span class="line"><span style="color:#A6ACCD;">    mount: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        async (props) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">            console.log(&#39;app1 mount1&#39;, props)</span></span>
<span class="line"><span style="color:#A6ACCD;">        },</span></span>
<span class="line"><span style="color:#A6ACCD;">        async () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">            console.log(&#39;app1 mount2&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    ],</span></span>
<span class="line"><span style="color:#A6ACCD;">    unmount: async (props) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(&#39;app1 unmount&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">let app2 = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    bootstrap: async () =&gt; console.log(&#39;app2 bootstrap1&#39;),</span></span>
<span class="line"><span style="color:#A6ACCD;">    mount: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        async () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">            return new Promise((resolve,reejct)=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">                setTimeout(()=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    console.log(&#39;app2 mount&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                    resolve()</span></span>
<span class="line"><span style="color:#A6ACCD;">                },1000)</span></span>
<span class="line"><span style="color:#A6ACCD;">            })</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    ],</span></span>
<span class="line"><span style="color:#A6ACCD;">    unmount: async () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(&#39;app2 unmount&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">// \u5F53\u8DEF\u5F84\u662F#/a \u7684\u65F6\u5019\u5C31\u52A0\u8F7D a\u5E94\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;">// \u5F53\u8DEF\u5F84\u662F#/b \u7684\u65F6\u5019\u5C31\u52A0\u8F7D b\u5E94\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;">// \u6240\u8C13\u7684\u6CE8\u518C\u5E94\u7528 \u5C31\u662F\u770B\u4E00\u4E0B\u8DEF\u5F84\u662F\u5426\u5339\u914D\uFF0C\u5982\u679C\u5339\u914D\u5219\u201C\u52A0\u8F7D\u201D\u5BF9\u5E94\u7684\u5E94\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;">registerApplication(&#39;a&#39;, async () =&gt; app1, location =&gt; location.hash.startsWith(&#39;#/a&#39;), { a: 1 })</span></span>
<span class="line"><span style="color:#A6ACCD;">registerApplication(&#39;b&#39;, async () =&gt; app2, location =&gt; location.hash.startsWith(&#39;#/b&#39;), { a: 1 })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// \u5F00\u542F\u8DEF\u5F84\u7684\u76D1\u63A7\uFF0C\u8DEF\u5F84\u5207\u6362\u7684\u65F6\u5019 \u53EF\u4EE5\u8C03\u7528\u5BF9\u5E94\u7684mount unmount</span></span>
<span class="line"><span style="color:#A6ACCD;">start()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>registerApplication\u7684\u4F5C\u7528\u662F\u6839\u636E\u8DEF\u5F84\u52A0\u8F7D\u5E94\u7528\uFF0C\u800Cstart\u7684\u4F5C\u7528\u662F\u5F00\u542F\u5E94\u7528\u5E76\u4E14\u6302\u8F7D\u7EC4\u4EF6\u3002</p><p>\u6211\u4EEC\u5148\u6765\u770B\u4E00\u4E0BregisterApplication\u7684\u5B9E\u73B0</p><h2 id="\u4E00\u3001registerapplication\u7684\u5B9E\u73B0" tabindex="-1">\u4E00\u3001registerApplication\u7684\u5B9E\u73B0 <a class="header-anchor" href="#\u4E00\u3001registerapplication\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">export const apps = []</span></span>
<span class="line"><span style="color:#A6ACCD;">export function registerApplication(appName,loadApp,activeWhen,customProps){</span></span>
<span class="line"><span style="color:#A6ACCD;">    const registeration = {</span></span>
<span class="line"><span style="color:#A6ACCD;">        name:appName,</span></span>
<span class="line"><span style="color:#A6ACCD;">        loadApp,</span></span>
<span class="line"><span style="color:#A6ACCD;">        activeWhen,</span></span>
<span class="line"><span style="color:#A6ACCD;">        customProps,</span></span>
<span class="line"><span style="color:#A6ACCD;">        status:NOT_LOADED</span></span>
<span class="line"><span style="color:#A6ACCD;">    };</span></span>
<span class="line"><span style="color:#A6ACCD;">    apps.push(registeration);</span></span>
<span class="line"><span style="color:#A6ACCD;">    reroute();</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>registerApplication\u4F1A\u5728\u5185\u90E8\u521B\u5EFA\u4E00\u4E2Aregisteration\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u7684status\u5C5E\u6027\u8BB0\u5F55\u4E86\u5F53\u524D\u6CE8\u518C\u7684\u5E94\u7528\u7684\u72B6\u6001\uFF0C\u5E94\u7528\u7684\u521D\u59CB\u72B6\u6001\u90FD\u662FNOT_LOADED\u3002</p><p>\u5E94\u7528\u7684\u72B6\u6001\u6709\u5982\u4E0B\u51E0\u79CD</p><ul><li>NOT_LOADED\u8868\u793A\u6CA1\u6709\u88AB\u52A0\u8F7D</li><li>LOADING_SOURCE_CODE\u8868\u793A\u8DEF\u5F84\u5339\u914D\u4E86\uFF0C\u8981\u53BB\u52A0\u8F7D\u8FD9\u4E2A\u8D44\u6E90</li><li>LOAD_ERROR\u8868\u793A\u52A0\u8F7D\u5931\u8D25</li></ul><p>\u542F\u52A8\u7684\u8FC7\u7A0B\u4E2D\u7684\u72B6\u6001</p><ul><li>NOT_BOOTSTRAPED\u8868\u793A\u8D44\u6E90\u52A0\u8F7D\u5B8C\u6BD5\u4E86</li><li>BOOTSTRAPING\u8868\u793A\u542F\u52A8\u4E2D</li><li>NOT_MOUNTED\u8868\u793A\u5DF2\u7ECF\u542F\u52A8\u4E86\u4F46\u662F\u8FD8\u6CA1\u6709\u88AB\u6302\u8F7D</li></ul><p>\u6302\u8F7D\u6D41\u7A0B\u7684\u72B6\u6001</p><ul><li>MOUNTING\u8868\u793A\u6B63\u5728\u6302\u8F7D</li><li>MOUNTED\u8868\u793A\u6302\u8F7D\u5B8C\u6210</li></ul><p>\u5378\u8F7D\u6D41\u7A0B\u7684\u72B6\u6001</p><ul><li>UNMOUNTING\u8868\u793A\u5378\u8F7D\u4E2D</li></ul><p>registerApplication\u6BCF\u8C03\u7528\u4E00\u6B21\u90FD\u4F1A\u5C06\u521B\u5EFA\u51FA\u6765\u7684registeration\u5BF9\u8C61\u5B58\u653E\u5230\u5168\u5C40\u7684apps\u4E2D\uFF0C\u63A5\u7740\u8C03\u7528reroute\u68C0\u67E5\u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u52A0\u8F7D\uFF0C\u8FD8\u6709\u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u6302\u8F7D\uFF0C\u8FD8\u6709\u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u79FB\u9664\u3002</p><p>\u4E00\u4E2A\u5E94\u7528\u4F1A\u7ECF\u5386\u4EE5\u4E0B\u8FD9\u51E0\u4E2A\u9636\u6BB5</p><p>\u672A\u52A0\u8F7D --&gt; \u52A0\u8F7D --&gt; \u6302\u8F7D --&gt; \u5378\u8F7D</p><p>reroute\u4F1A\u8C03\u7528getAppChanges\u65B9\u6CD5\u5C06\u5F53\u524D\u6CE8\u518C\u7684\u5E94\u7528\u5206\u7C7B\u4E3A\u5C06\u88AB\u52A0\u8F7D\u7684\u5E94\u7528\uFF08appsToLoad\uFF09\uFF0C\u5C06\u88AB\u6302\u8F7D\u7684\u5E94\u7528\uFF08appsToMount\uFF09\uFF0C\u4EE5\u53CA\u5C06\u88AB\u5378\u8F7D\u7684\u5E94\u7528\uFF08appsToUnmount\uFF09\u3002</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">export function getAppChanges() {</span></span>
<span class="line"><span style="color:#A6ACCD;">    const appsToLoad = [];</span></span>
<span class="line"><span style="color:#A6ACCD;">    const appsToMount = [];</span></span>
<span class="line"><span style="color:#A6ACCD;">    const appsToUnmount = [];</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    apps.forEach((app) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">        let appShouldBeActive = shouldBeActive(app)</span></span>
<span class="line"><span style="color:#A6ACCD;">        switch(app.status) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            case NOT_LOADED:</span></span>
<span class="line"><span style="color:#A6ACCD;">            case LOADING_SOURCE_CODE:</span></span>
<span class="line"><span style="color:#A6ACCD;">                // 1\uFF09 \u6807\u8BB0\u5F53\u524D\u8DEF\u5F84\u4E0B \u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#A6ACCD;">                if(appShouldBeActive) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    appsToLoad.push(app)</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">                break;</span></span>
<span class="line"><span style="color:#A6ACCD;">            case NOT_BOOTSTRAPED:  </span></span>
<span class="line"><span style="color:#A6ACCD;">            case BOOTSTRAPING:</span></span>
<span class="line"><span style="color:#A6ACCD;">            case NOT_MOUNTED:</span></span>
<span class="line"><span style="color:#A6ACCD;">                // 2) \u5F53\u524D\u8DEF\u5F84\u4E0B \u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u6302\u5728</span></span>
<span class="line"><span style="color:#A6ACCD;">                if(appShouldBeActive) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    appsToMount.push(app)</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">                break;</span></span>
<span class="line"><span style="color:#A6ACCD;">            case MOUNTED:</span></span>
<span class="line"><span style="color:#A6ACCD;">                // 3\uFF09 \u5F53\u524D\u8DEF\u5F84\u4E0B \u54EA\u4E9B\u5E94\u7528\u8981\u88AB\u5378\u8F7D</span></span>
<span class="line"><span style="color:#A6ACCD;">                if(!appShouldBeActive) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    appsToUnmount.push(app)</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">                break</span></span>
<span class="line"><span style="color:#A6ACCD;">            default:</span></span>
<span class="line"><span style="color:#A6ACCD;">                break;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">    return {appsToLoad,appsToMount,appsToUnmount};</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>getAppChanges\u5C06\u6240\u6709\u5DF2\u7ECF\u6CE8\u518C\u7684\u5E94\u7528\u8FDB\u884C\u5206\u7C7B\uFF0C\u904D\u5386\u5F53\u524D\u6240\u6709\u7684\u5E94\u7528\uFF0C\u5982\u679C\u53D1\u73B0\u5E94\u7528\u7684\u72B6\u6001\u4E3ANOT_LOADED\uFF08\u672A\u52A0\u8F7D\uFF09\u6216\u8005LOADING_SOURCE_CODE\uFF08\u6B63\u5728\u52A0\u8F7D\u8D44\u6E90\uFF09\uFF0C\u90A3\u4E48\u518D\u5224\u65AD\u5E94\u7528\u662F\u5426\u5E94\u8BE5\u88AB\u6FC0\u6D3B\uFF08appShouldBeActive\uFF09\uFF0C\u5982\u679C\u4E3A\u662F\u7684\u8BDD\uFF0C\u90A3\u4E48\u5C06\u6B64\u5E94\u7528\u653E\u5230appsToLoad\uFF1B\u5982\u679C\u53D1\u73B0\u5E94\u7528\u7684\u72B6\u6001\u4E3ANOT_BOOTSTRAPED\uFF08\u672A\u542F\u52A8\uFF09\uFF0C\u6216\u8005\u662FBOOTSTRAPING\uFF08\u542F\u52A8\u4E2D\uFF09\u3001NOT_MOUNTED\uFF08\u672A\u6302\u8F7D\uFF09\uFF0C\u90A3\u4E48\u518D\u5224\u65AD\u5E94\u7528\u662F\u5426\u5E94\u8BE5\u88AB\u6FC0\u6D3B\uFF08appShouldBeActive\uFF09\uFF0C\u5982\u679C\u4E3A\u662F\u7684\u8BDD\uFF0C\u90A3\u4E48\u5C06\u6B64\u5E94\u7528\u653E\u5230appsToMount\uFF1B\u5982\u679C\u53D1\u73B0\u5E94\u7528\u7684\u72B6\u6001\u4E3AMOUNTED\uFF08\u5DF2\u6302\u8F7D\uFF09\uFF0C\u90A3\u4E48\u9700\u8981\u518D\u5224\u65AD\u5E94\u7528\u662F\u5426\u4E0D\u5E94\u8BE5\u88AB\u6FC0\u6D3B\uFF0C\u5982\u679C\u662F\u7684\u8BDD\uFF0C\u90A3\u4E48\u5C06\u6B64\u5E94\u7528\u653E\u5230appsToUnmount\u3002</p><p>PS\uFF1AappShouldBeActive\u662F\u6839\u636E\u4EC0\u4E48\u6765\u5224\u65AD\u7684\u5462\uFF1F</p><p>\u7B54\u6848\uFF1A\u6839\u636E\u5E94\u7528\u4F20\u8FDB\u6765\u7684activeWhen</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">let appShouldBeActive = shouldBeActive(app);</span></span>
<span class="line"><span style="color:#A6ACCD;">export function shouldBeActive(app){</span></span>
<span class="line"><span style="color:#A6ACCD;">    return app.activeWhen(window.location)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u8FD8\u8BB0\u5F97\u6211\u4EEC\u524D\u9762\u8BF4\u8FC7\u7684\u201DregisterApplication\u7684\u4F5C\u7528\u662F\u6839\u636E\u8DEF\u5F84\u52A0\u8F7D\u5E94\u7528\uFF0C\u800Cstart\u7684\u4F5C\u7528\u662F\u5F00\u542F\u5E94\u7528\u5E76\u4E14\u6302\u8F7D\u7EC4\u4EF6\u201C\u5417\uFF1F</p><p>\u90A3\u5F53\u903B\u8F91\u53EA\u6267\u884C\u5230registerApplication\u6CE8\u518C\u5E94\u7528\uFF0C\u8FD8\u6CA1\u5F00\u542F\u5E94\u7528\u7684\u65F6\u5019\uFF0C\u4F1A\u5148\u8FDB\u884C\u4EC0\u4E48\u64CD\u4F5C\uFF1F\u524D\u9762\u5DF2\u7ECF\u8BF4\u8FC7\u4E86<strong>\u6839\u636E\u8DEF\u5F84\u52A0\u8F7D\u5E94\u7528</strong>\uFF0C\u597D\u597D\u7406\u89E3\u4E00\u4E0B\u8FD9\u53E5\u8BDD\uFF0C\u6839\u636E\u8DEF\u5F84\uFF0C\u7136\u540E\u52A0\u8F7D\u5E94\u7528\u3002</p><p>\u6839\u636E\u8DEF\u5F84\u6211\u4EEC\u8FD9\u4E00\u6B65\u5DF2\u7ECF\u5728getAppChanges\u5904\u7406\u8FC7\u4E86\uFF0C\u5C06\u6CE8\u518C\u7684\u5E94\u7528\u8FDB\u884C\u5206\u7C7B\uFF0C\u90A3\u4E48\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u8981\u5C06\u5206\u7C7B\u51FA\u6765\u7684appsToLoad\u904D\u5386\u52A0\u8F7D\u3002</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function loadApps() {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // \u5E94\u7528\u7684\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#A6ACCD;">    return Promise.all(appsToLoad.map(toLoadPromise)) // \u5230\u76EE\u524D\u4E3A\u6B62\u6211\u4EEC\u8FD8\u6CA1\u6709\u8C03\u7528start </span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u90A3\u4E48toLoadPromise\u7A76\u7ADF\u662F\u505A\u4EC0\u4E48\u7684\u5462\uFF1F</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">export function toLoadPromise(app){</span></span>
<span class="line"><span style="color:#A6ACCD;">    return Promise.resolve().then(()=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        if(app.status !== NOT_LOADED){</span></span>
<span class="line"><span style="color:#A6ACCD;">            // \u6B64\u5E94\u7528\u52A0\u8F7D\u5B8C\u6BD5\u4E86 </span></span>
<span class="line"><span style="color:#A6ACCD;">            return app;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        app.status = LOADING_SOURCE_CODE; // \u6B63\u5728\u52A0\u8F7D\u5E94\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        // loadApp \u5BF9\u4E8E\u4E4B\u524D\u7684\u5185\u5BB9 System.import()</span></span>
<span class="line"><span style="color:#A6ACCD;">        return app.loadApp(app.customProps).then(v=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">            const {bootstrap,mount,unmount} = v;</span></span>
<span class="line"><span style="color:#A6ACCD;">            app.status = NOT_BOOTSTRAPED;</span></span>
<span class="line"><span style="color:#A6ACCD;">            app.bootstrap = flattenArrayToPromise(bootstrap);</span></span>
<span class="line"><span style="color:#A6ACCD;">            app.mount = flattenArrayToPromise(mount);</span></span>
<span class="line"><span style="color:#A6ACCD;">            app.unmount = flattenArrayToPromise(unmount);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            return app</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u5F88\u7B80\u5355\uFF0C\u5148\u5224\u65AD\u5E94\u7528\u7684\u72B6\u6001\u662F\u5426\u4E0D\u7B49\u4E8ENOT_LOADED\uFF08\u672A\u52A0\u8F7D\uFF09\uFF0C\u56E0\u4E3A\u72B6\u6001\u5C5E\u4E8E\u672A\u52A0\u8F7D\u7684\u5E94\u7528\u624D\u9700\u8981\u52A0\u8F7D\u561B~\uFF0C\u5982\u679C\u4E0D\u662FNOT_LOADED\u7684\u8BDD\u76F4\u63A5\u8FD4\u56DE\u8BE5\u5E94\u7528\u3002\u5982\u679C\u7B49\u4E8ENOT_LOADED \u7684\u8BDD\uFF0C\u90A3\u4E48\u5C31\u8C03\u7528\u6CE8\u518C\u5E94\u7528\u7684\u65F6\u5019\u4F20\u8FDB\u6765\u7684loadApp\u65B9\u6CD5\uFF0C\u52A0\u8F7D\u5B8C\u4E4B\u540E\u5C31\u9700\u8981\u4FEE\u6539\u72B6\u6001\u4E3ANOT_BOOTSTRAPED\uFF08\u5DF2\u52A0\u8F7D\u672A\u6302\u8F7D\uFF09\uFF0C\u5E76\u4E14\u8981\u91CD\u65B0\u5904\u7406\u4E00\u4E0B\u6CE8\u518C\u7684\u65F6\u5019\u4F20\u8FDB\u6765\u7684\u751F\u547D\u5468\u671F\u94A9\u5B50bootstrap\u3001mount\u3001unmount\u3002\u56E0\u4E3A\u4F20\u8FDB\u6765\u7684\u751F\u547D\u5468\u671F\u94A9\u5B50\u53EF\u80FD\u662F\u4E00\u4E2A\u8FD4\u56DEPromise\u7684\u51FD\u6570\uFF0C\u4E5F\u53EF\u80FD\u662F\u7531\u51E0\u4E2A\u8FD4\u56DEPromise\u7684\u51FD\u6570\u7EC4\u5408\u800C\u6210\u7684\u6570\u7EC4\uFF0C\u56E0\u6B64\u9700\u8981\u7528flattenArrayToPromise\u8FDB\u884C\u5904\u7406\u3002</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">function flattenArrayToPromise(fns) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    fns = Array.isArray(fns) ? fns : [fns]</span></span>
<span class="line"><span style="color:#A6ACCD;">    return function(props){ </span></span>
<span class="line"><span style="color:#A6ACCD;">        return fns.reduce((rPromise,fn)=&gt;rPromise.then(()=&gt;fn(props)), Promise.resolve())</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,33),r=[e];function o(c,i,t,A,b,C){return a(),n("div",null,r)}const D=s(l,[["render",o]]);export{m as __pageData,D as default};
